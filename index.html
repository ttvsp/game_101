<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карточная Игра 101</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {background-color:#121212;color:#e0e0e0;font-family:'Roboto',sans-serif;margin:0;padding:20px;display:flex;flex-direction:column;align-items:center;}
        h1, h2 {color:#ffffff;font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,0.5);}
        h1 {font-size:2.5em;margin-bottom:20px;}
        h2 {font-size:1.5em;margin:15px 0;}
        input, button {background-color:#1e1e1e;color:#e0e0e0;border:1px solid #333;padding:10px;margin:5px;border-radius:8px;font-size:16px;transition:all 0.3s ease;}
        button {cursor:pointer;}
        button:hover {background-color:#333;border-color:#555;}
        .container {max-width:800px;width:100%;text-align:center;}
        .players-input {display:flex;flex-direction:column;align-items:center;}
        .player-input {display:flex;align-items:center;margin:5px 0;}
        .player-input input {width:200px;margin-right:10px;}
        .remove-player {background-color:transparent;border:none;color:#ff4d4d;font-size:20px;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;}
        .remove-player:hover {color:#cc0000;}
        .game-section {display:none;}
        .game-columns {display:flex;justify-content:space-between;align-items:flex-start;}
        .left-column, .right-column {width:48%;}
        .scores {margin:0;display:flex;flex-direction:column;align-items:flex-start;}
        .score-item {background-color:#1e1e1e;padding:12px;margin:5px 0;border-radius:8px;width:100%;text-align:left;box-shadow:0 2px 4px rgba(0,0,0,0.3);}
        .round-inputs {display:flex;flex-direction:column;align-items:flex-start;}
        .round-input {display:flex;align-items:center;margin:5px 0;width:100%;}
        .round-input label {width:150px;text-align:right;margin-right:10px;}
        #submit-button {display:block;margin:10px auto 0;}
        #chart-container {margin-top:20px;background-color:#1e1e1e;padding:15px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.3);height:400px;}
        #game-over {color:#ff4d4d;font-size:1.8em;margin:20px 0;display:none;}
        #restart-button {background-color:#4caf50;margin:10px 0 0 auto;display:block;}
        #restart-button:hover {background-color:#388e3c;}
        .chart-section {width:100%;}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>101</h1>
        
        <div id="setup-section" class="players-input">
            <h2>Введите имена игроков</h2>
            <div id="player-inputs"></div>
            <button onclick="addPlayerInput()">Добавить игрока</button>
            <button onclick="startGame()">Начать игру</button>
        </div>
        
        <div id="game-section" class="game-section">
            <div class="game-columns">
                <div class="left-column">
                    <h2>Текущий счет</h2>
                    <div id="scores" class="scores"></div>
                </div>
                <div class="right-column">
                    <h2>Ввод очков за раздачу</h2>
                    <div id="round-inputs" class="round-inputs"></div>
                    <button id="submit-button" onclick="submitRound()">Записать результат</button>
                </div>
            </div>
            
            <h2 id="game-over">Игра окончена!</h2>
            
            <div class="chart-section">
                <h2>Динамика счета</h2>
                <div id="chart-container">
                    <canvas id="score-chart"></canvas>
                </div>
                <button id="restart-button" onclick="restartGame()">Начать заново</button>
            </div>
        </div>
    </div>

    <script>
        let players = [];
        let scores = {};
        let history = {};
        let roundNumber = 0;
        let chart;
        let playerInputCount = 0;

        window.onload = function() {
            addPlayerInput();
            addPlayerInput();
        };

        function addPlayerInput(name = '') {
            playerInputCount++;
            const inputsDiv = document.getElementById('player-inputs');
            const div = document.createElement('div');
            div.className = 'player-input';
            div.id = `player-input-${playerInputCount}`;
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'Имя игрока';
            input.value = name;
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-player';
            removeBtn.textContent = '×';
            removeBtn.onclick = () => removePlayerInput(playerInputCount);
            div.appendChild(input);
            div.appendChild(removeBtn);
            inputsDiv.appendChild(div);
        }

        function removePlayerInput(id) {
            const div = document.getElementById(`player-input-${id}`);
            if (div) div.remove();
        }

        function startGame() {
            const inputDivs = document.querySelectorAll('.player-input input');
            players = Array.from(inputDivs).map(input => input.value.trim()).filter(name => name !== '');
            if (players.length < 2) {
                alert('Добавьте хотя бы двух игроков!');
                return;
            }
            players.forEach(player => {
                scores[player] = 0;
                history[player] = [0];
            });
            
            document.getElementById('setup-section').style.display = 'none';
            document.getElementById('game-section').style.display = 'block';
            
            updateScoresDisplay();
            updateRoundInputs();
            initChart();
            updateChart(); // Initial update to show starting at 0
            document.getElementById('game-over').style.display = 'none';
            document.getElementById('round-inputs').style.display = 'flex';
            document.getElementById('submit-button').style.display = 'block';
        }

        function updateScoresDisplay() {
            const scoresDiv = document.getElementById('scores');
            scoresDiv.innerHTML = '';
            players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'score-item';
                div.textContent = `${player}: ${scores[player]}`;
                scoresDiv.appendChild(div);
            });
        }

        function updateRoundInputs() {
            const inputsDiv = document.getElementById('round-inputs');
            inputsDiv.innerHTML = '';
            players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'round-input';
                const label = document.createElement('label');
                label.textContent = `${player}:`;
                const input = document.createElement('input');
                input.type = 'number';
                input.id = `points-${player}`;
                input.placeholder = 'Очки';
                div.appendChild(label);
                div.appendChild(input);
                inputsDiv.appendChild(div);
            });
        }

        function submitRound() {
            let allFilled = true;
            const points = {};
            players.forEach(player => {
                const input = document.getElementById(`points-${player}`);
                const value = parseInt(input.value, 10);
                if (isNaN(value)) {
                    allFilled = false;
                    return;
                }
                points[player] = value;
                input.value = '';
            });
            
            if (!allFilled) {
                alert('Введите очки для всех игроков!');
                return;
            }
            
            roundNumber++;
            let gameOver = false;
            players.forEach(player => {
                let newScore = scores[player] + points[player];
                if (newScore === 100) {
                    newScore = 50;
                } else if (newScore === 101) {
                    newScore = 0;
                } else if (newScore > 101) {
                    gameOver = true;
                    alert(`${player} проиграл! Счет превысил 101.`);
                }
                scores[player] = newScore;
                history[player].push(newScore);
            });
            
            updateScoresDisplay();
            updateChart();
            
            if (gameOver) {
                document.getElementById('round-inputs').style.display = 'none';
                document.getElementById('submit-button').style.display = 'none';
                document.getElementById('game-over').style.display = 'block';
            }
        }

        function initChart() {
            const ctx = document.getElementById('score-chart').getContext('2d');
            const datasets = players.map(player => ({
                label: player,
                data: [],
                borderColor: getBrightColor(),
                backgroundColor: getBrightColor(),
                fill: false,
                tension: 0.1,
                pointStyle: 'circle',
                pointRadius: 5,
                pointBackgroundColor: getBrightColor(),
                pointBorderColor: '#fff',
                pointBorderWidth: 0
            }));
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: datasets
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {display: true, text: 'Счет', color: '#e0e0e0'},
                            grid: {color: '#333'},
                            ticks: {color: '#e0e0e0'}
                        },
                        x: {
                            title: {display: false},
                            grid: {color: '#333'},
                            ticks: {color: '#e0e0e0'}
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {color: '#e0e0e0', usePointStyle: true, pointStyle: 'circle', boxWidth: 6, padding: 30, boxPadding: 15}
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateChart() {
            chart.data.labels = Array.from({length: roundNumber + 1}, (_, i) => i);
            players.forEach((player, index) => {
                chart.data.datasets[index].data = history[player];
            });
            chart.update();
        }

        function getBrightColor() {
            const h = Math.random() * 360;
            const s = 100;
            const l = 70;
            return `hsl(${h}, ${s}%, ${l}%)`;
        }

        function restartGame() {
            location.reload();
        }
    </script>
</body>
</html>
